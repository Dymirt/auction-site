{% extends "auctions/layout.html" %}

{% block body %}
    <div class='container'>

        <div class="row">
            {% if not listing.is_active %}
            <div class='col'>
                <p style='background-color: red'>This auction is closed.</p>
            </div>
                {% if listing.highest_bid.user == user %}
                    <div class='col'>
                        <h3>You win this Auction!!! </h3>
                    </div>
                {% else %}
                    <div class='col'>
                        <h3> {{ listing.highest_bid.user }} win this auction!</h3>
                    </div>
                {% endif %}
            {% endif %}
        </div>

        <div class='row'>
            <div class='col'>
                <img style="width: 100%;" src='{{ listing.image_url }}'>
            </div>
            <div class='col'>
                <h3>{{ listing.title }}</h3>
                {% if listing.bids.all %}
                    <p> Highest bid: {{ listing.highest_bid.bid }}$</p>
                    <p>Bids placed: {{ listing.bids.count }}</p>
                {% else %}
                    <p> Starting price: {{ listing.starting_bid }}$</p>
                    <p>No bids yet.</p>
                {% endif %}
                {% if listing.is_active %}
                    {% if user.is_authenticated %}
                        {% if listing.user != user %}
                            <form action="{% url 'listing' listing.id %}" method='post'>
                                {% csrf_token %}
                                {{ bid_form }}
                                <input type=submit value="Place Bid">
                            </form>
                            <form action='wishlist' method="post" >
                            {% csrf_token %}
                            <input value="{{ listing.id }}" name='listing_id' type="hidden" >
                                {% if user in listing.followers.all %}
                                    <input type=submit value="Remove from Wishlist">
                                {% else %}
                                    <input type=submit value="Add to Wishlist">
                                {% endif %}
                            </form>
                        {% else %}
                            {% if listing.is_active %}
                                <form action="{% url 'closelisting' listing.id %}" method=post>
                                    {% csrf_token %}
                                    <input type=submit value='Close auction'>
                                </form>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
                <p> Description: {{ listing.description }}</p>
                <p>Seller: {{ listing.user }}</p>
                <p>Category: <a href= "{% url 'category' listing.category %}">{{ listing.category }}</a></p>
                <p>Listing id: {{ listing.id }}</p>
            </div>
        </div>
        {% include 'auctions/partials/comments.html' %}
    </div>
{% endblock %}